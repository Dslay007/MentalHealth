<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulCare - Web Dashboard</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Font Inter dari Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Memuat ikon Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Menggunakan font Inter sebagai default */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #111827; /* bg-gray-900 */
            /* Dihapus: height: 100vh; overflow: hidden; (Sekarang diatur oleh app-container) */
        }

        /* Konten utama yang bisa di-scroll */
        #screen-content {
            height: 100vh;
            overflow-y: auto;
            /* Latar belakang gradien gamified */
            background-image: linear-gradient(to bottom right, #1f2937, #312e81); /* from-gray-800 to-indigo-900 */
            /* (MODIFIKASI) Padding bawah dikurangi karena nav bawah hilang */
            padding-bottom: 60px; 
            transition: opacity 0.5s ease-in-out;
        }

        /* Scrollbar kustom */
        #screen-content::-webkit-scrollbar { width: 6px; }
        #screen-content::-webkit-scrollbar-track { background: #374151; } 
        #screen-content::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; } 
        #screen-content::-webkit-scrollbar-thumb:hover { background: #6366f1; } 

        /* Scrollbar kustom untuk Histori Jurnal */
        #journal-history-list::-webkit-scrollbar { width: 5px; }
        #journal-history-list::-webkit-scrollbar-track { background: #4b5563; } 
        #journal-history-list::-webkit-scrollbar-thumb { background: #818cf8; border-radius: 10px; } 

        /* (DIHAPUS) Style untuk Nav Bar Bawah LAMA */
        /* ... Style #bottom-nav dan .bottom-nav-btn dihapus ... */

        /* ======================================================== */
        /* ===== (MODIFIKASI) Halaman Welcome (Responsive FIX) ===== */
        /* ======================================================== */
        #page-welcome {
            transition: opacity 0.5s ease-in-out;
            min-height: 100vh; 
            /* (BARU) Tambahan untuk memastikan welcome screen ada di atas */
            position: fixed; /* Mengatur posisi agar bisa menggunakan z-index */
            top: 0;
            left: 0;
            width: 100%; /* Pastikan menutupi seluruh layar */
            z-index: 60; /* z-index tertinggi agar di atas modal (z-50) */
        }

        /* Animasi untuk lingkaran pernapasan */
        @keyframes breathe {
            0%, 100% { transform: scale(0.9); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        .breathing-circle { animation: breathe 5s ease-in-out infinite; }
        
        /* Animasi loading chat */
        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }
        #typing-indicator p:after {
            content: " mengetik"; /* Default text */
            animation: dots 1.5s infinite;
        }

        /* Transisi hover yang lebih 'playful' */
        .card-hover {
            transition: all 0.2s ease-in-out;
            position: relative; 
            overflow: hidden; 
        }
        .card-hover:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.3);
        }
        
        /* Scrollbar chat disembunyikan */
        #chat-messages::-webkit-scrollbar { display: none; }
        #chat-messages { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Quote Carousel Fix */
        .quote-slide {
            flex-shrink: 0;
            width: 100%;
        }
        #quote-track {
            transition: transform 0.7s ease-in-out;
            height: 100%; /* Penting untuk containment */
            display: flex; /* Untuk menempatkan slides secara horizontal */
        }
        
        /* (BARU) Style untuk Bar Chart */
        .chart-bar {
            transition: width 1.5s ease-in-out;
            width: 0; /* Mulai dari 0 */
        }
        
        /* ================================= */
        /* ===== (BARU) STYLE SIDEBAR ===== */
        /* ================================= */
        .sidebar-btn {
            transition: all 0.2s ease-in-out;
            color: #9ca3af; /* text-gray-400 */
            font-weight: 500; /* medium */
        }
        .sidebar-btn:hover {
            background-color: #4f46e5; /* hover:bg-indigo-600 */
            color: #ffffff; /* hover:text-white */
            transform: translateX(4px); /* Efek hover "game-like" */
        }
        .sidebar-btn.active {
            background-color: #4f46e5; /* bg-indigo-600 */
            color: #ffffff; /* text-white */
            font-weight: 600; /* semibold */
            box-shadow: 0 4px 14px -4px rgba(79, 70, 229, 0.6);
        }
        .sidebar-btn.active svg {
            transform: scale(1.1);
        }

        /* (BARU) Menangani scrollbar di sidebar jika menunya banyak */
        #sidebar::-webkit-scrollbar { width: 4px; }
        #sidebar::-webkit-scrollbar-track { background: #1f2937; }
        #sidebar::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }


        /* =================================================== */
        /* ===== (BARU) STYLE SIDEBAR MINIMIZE & LOGOUT ===== */
        /* =================================================== */
        #sidebar {
            /* (BARU) Tambahkan transisi untuk width */
            transition: width 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        #minimize-btn {
            transition: all 0.2s ease-in-out;
            color: #9ca3af; /* text-gray-400 */
            font-weight: 500; /* medium */
        }
        #minimize-btn:hover {
            background-color: #374151; /* hover:bg-gray-700 */
            color: #ffffff;
        }
        
        #logout-btn {
            transition: all 0.2s ease-in-out;
            color: #9ca3af; /* text-gray-400 */
            font-weight: 500; /* medium */
        }
        #logout-btn:hover {
            background-color: #374151; /* hover:bg-gray-700 */
            color: #ffffff;
        }
        
        /* State Saat Sidebar Minimize */
        #sidebar.minimized {
            width: 80px; /* Lebar saat minimize (cukup untuk ikon) */
        }
        #sidebar.minimized #sidebar-header h2 {
            /* (BARU) Sembunyikan teks SoulCare saat minimize */
            display: none;
        }
        #sidebar.minimized #sidebar-header {
             /* (BARU) Sesuaikan padding saat minimize */
            padding-top: 1.25rem;
            padding-bottom: 1.25rem;
        }
         #sidebar.minimized #minimize-btn {
             /* (BARU) Pindahkan tombol toggle ke tengah */
            justify-content: center;
        }
         #sidebar.minimized #minimize-btn svg {
             /* (BARU) Balik ikon panah */
            transform: rotate(180deg);
        }
        #sidebar.minimized .sidebar-btn span,
        #sidebar.minimized #logout-btn span,
        #sidebar.minimized #minimize-btn span {
            /* Sembunyikan teks menu */
            display: none;
        }
        #sidebar.minimized .sidebar-btn,
        #sidebar.minimized #logout-btn {
            /* Pusatkan ikon */
            justify-content: center;
        }
        #sidebar.minimized .sidebar-btn:hover {
             /* Hapus transisi hover saat minimize */
            transform: none;
        }


        /* ======================================= */
        /* ===== (BARU) STYLE MODAL JURNAL ===== */
        /* ======================================= */
        #journal-detail-modal.show {
            opacity: 1;
            visibility: visible;
        }
        #journal-detail-modal.show > div:not(.absolute) { /* Target konten modal, bukan backdrop */
            transform: scale(1);
            opacity: 1;
        }

        /* Scrollbar kustom untuk konten modal jika terlalu panjang */
        #journal-detail-modal .max-h-\[70vh\]::-webkit-scrollbar { width: 5px; }
        #journal-detail-modal .max-h-\[70vh\]::-webkit-scrollbar-track { background: #4b5563; }
        #journal-detail-modal .max-h-\[70vh\]::-webkit-scrollbar-thumb { background: #818cf8; border-radius: 10px; }


        /* ============================================ */
        /* ===== (MODIFIKASI) RESPONSIVE LAYOUT ===== */
        /* ============================================ */

        /* Tampilan Mobile */
        @media (max-width: 767px) {
            /* (MODIFIKASI) Pastikan sidebar kembali ke state full-width di mobile */
            #sidebar, #sidebar.minimized {
                width: 16rem; /* w-64 */
                transform: translateX(-100%);
            }
            #sidebar.open {
                transform: translateX(0);
            }
            /* (BARU) Sembunyikan tombol minimize di mobile */
            #minimize-btn-container {
                display: none;
            }
            /* (BARU) Tampilkan tombol logout di mobile */
            #logout-btn-container {
                display: block;
            }
        }

        /* Tampilan Desktop */
        @media (min-width: 768px) {
            /* Sembunyikan tombol hamburger dan backdrop di desktop */
            #mobile-menu-btn {
                display: none;
            }
            #sidebar-backdrop {
                display: none;
            }
        }
        
    </style>
</head>
<body class="min-h-screen">

    <!-- (BARU) Wrapper Aplikasi Utama -->
    <!-- h-screen dan overflow-hidden penting untuk layout sidebar -->
    <div id="app-container" class="flex h-screen overflow-hidden hidden opacity-0">

        <!-- ================================== -->
        <!-- ===== (BARU) Sidebar Kiri ===== -->
        <!-- ================================== -->
        <!-- Sidebar ini akan disembunyikan di mobile dan ditampilkan di desktop -->
        <nav id="sidebar" class="fixed md:relative z-40 flex h-full w-64 flex-col bg-gray-900 shadow-lg transition-transform duration-300 ease-in-out md:translate-x-0 -translate-x-full">
            
            <!-- (MODIFIKASI) Header "Game-like" - Poin Dihapus -->
            <div id="sidebar-header" class="p-4 text-center border-b border-gray-700">
                <h2 class="text-2xl font-bold text-white">SoulCare</h2>
                <!-- (DIHAPUS) Div poin refleksi -->
            </div>

            <!-- (MODIFIKASI) Menu Navigasi & Tombol Logout/Minimize -->
            <!-- Wrapper baru untuk memisahkan menu scrollable dari tombol bawah -->
            <div class="flex flex-col flex-1 justify-between overflow-y-hidden">

                <!-- Menu Navigasi (Dibuat scrollable) -->
                <div class="flex-1 space-y-2 px-2 py-4 overflow-y-auto">
                    <!-- Tombol Home -->
                    <button id="nav-home-btn" onclick="showPage('page-home')" class="sidebar-btn group flex w-full items-center space-x-3 rounded-lg p-3 active">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                        <span>Home</span>
                    </button>
                    <!-- Tombol Tes -->
                    <button id="nav-test-btn" onclick="showPage('page-test')" class="sidebar-btn group flex w-full items-center space-x-3 rounded-lg p-3">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                        <span>Pusat Tes</span>
                    </button>
                    <!-- Tombol Jurnal -->
                    <button id="nav-journal-btn" onclick="showPage('page-journal')" class="sidebar-btn group flex w-full items-center space-x-3 rounded-lg p-3">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                        <span>Jurnal Harian</span>
                    </button>
                    <!-- Tombol Games -->
                    <button id="nav-games-btn" onclick="showPage('page-games')" class="sidebar-btn group flex w-full items-center space-x-3 rounded-lg p-3">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M12 12m-4 0a4 4 0 1 0 8 0 4 4 0 1 0-8 0"></path></svg>
                        <span>Mini-Games</span>
                    </button>
                    <!-- Tombol Chat -->
                    <button id="nav-chat-btn" onclick="showPage('page-chat')" class="sidebar-btn group flex w-full items-center space-x-3 rounded-lg p-3">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                        <span>Soul-AI Chat</span>
                    </button>
                    <!-- Tombol Profil -->
                    <button id="nav-profile-btn" onclick="showPage('page-profile')" class="sidebar-btn group flex w-full items-center space-x-3 rounded-lg p-3">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                        <span>Profil</span>
                    </button>
                </div> <!-- Akhir div menu scrollable -->

                <!-- (BARU) Tombol Minimize & Logout (Area Bawah) -->
                <div class="border-t border-gray-700 p-2 space-y-1">
                    <!-- Tombol Minimize (Hanya Desktop) -->
                    <div id="minimize-btn-container" class="hidden md:block">
                        <button id="minimize-btn" onclick="toggleSidebar()" class="flex w-full items-center space-x-3 rounded-lg p-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6 transition-transform duration-300"><polyline points="15 18 9 12 15 6"></polyline></svg>
                            <span>Minimize</span>
                        </button>
                    </div>
                    <!-- Tombol Logout -->
                    <div id="logout-btn-container">
                         <button id="logout-btn" onclick="logout()" class="group flex w-full items-center space-x-3 rounded-lg p-3">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                             <span>Keluar</span>
                         </button>
                    </div>
                </div>

            </div> <!-- Akhir wrapper flex-col -->
        </nav>

        <!-- (BARU) Backdrop untuk Sidebar Mobile -->
        <div id="sidebar-backdrop" class="fixed inset-0 z-30 hidden bg-black/50 transition-opacity duration-300 ease-in-out md:hidden"></div>


        <!-- (DIMODIFIKASI) Konten Layar (sekarang di dalam app-container) -->
        <!-- CSS di #screen-content (overflow-y: auto) akan membuatnya bisa di-scroll secara independen -->
        <!-- (MODIFIKASI) class 'hidden' dan 'opacity-0' dihapus dari sini dan dipindah ke app-container -->
        <main id="screen-content" class="relative flex-1 opacity-100"> 
            
            <!-- Halaman 1: Home/Dashboard (Default) - REDESIGN -->
            <div id="page-home" class="page p-6 md:p-12 space-y-8">
                <!-- Header Sapaan -->
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Selamat Datang, Dona!</h1>
                    <p id="vibe-header" class="text-base md:text-lg text-gray-300 transition-all mt-1">Bagaimana perasaanmu hari ini?</p>
                </div>
                
                <!-- Grid Dashboard BARU -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-stretch">
                    
                    <!-- Row 1: Stat Bar (Full Width) -->
                    <div class="lg:col-span-3 bg-gray-800/50 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-gray-700">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                            <!-- Stat 1: Poin Refleksi (Dengan Ikon Koin) -->
                            <div>
                                <h4 class="text-sm font-semibold text-purple-300 uppercase tracking-wider">Poin Refleksi</h4>
                                <div class="flex items-center justify-center mt-1 space-x-2">
                                    <!-- (MODIFIKASI) Ikon Koin diganti Ikon Permata (Gem) -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#FBBF24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400"><path d="M6 3h12l4 6-10 13L2 9Z"></path><path d="M12 22 2 9"></path><path d="m22 9-4-6"></path></svg>
                                    <p id="stat-points" class="text-4xl font-bold text-white">120</p>
                                </div>
                            </div>
                            <!-- Stat 2: Streak Jurnal -->
                            <div>
                                <h4 class="text-sm font-semibold text-orange-300 uppercase tracking-wider">Streak Jurnal</h4>
                                <p id="stat-streak" class="text-4xl font-bold text-white mt-1">ðŸ”¥ 5</p>
                            </div>
                            <!-- Stat 3: Jurnal Tersimpan -->
                            <div>
                                <h4 class="text-sm font-semibold text-blue-300 uppercase tracking-wider">Jurnal Tersimpan</h4>
                                <p id="stat-journal-count" class="text-4xl font-bold text-white mt-1">3</p>
                            </div>
                        </div>
                    </div>

                    <!-- Row 2: Left (2/3) - AI Insight & Action -->
                    <div class="lg:col-span-2 space-y-6 flex flex-col">
                        <!-- AI Insight & Daily Challenge (Combined into Action Card) -->
                        <div class="bg-gradient-to-br from-indigo-600 to-purple-700 text-white p-6 md:p-8 rounded-2xl shadow-xl flex items-start space-x-4 md:space-x-5 card-hover relative h-full border border-indigo-500">
                            <div class="flex-shrink-0 z-10">
                                <div class="p-4 bg-white/30 rounded-xl shadow-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"></path><path d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"></path></svg>
                                </div>
                            </div>
                            <div class="relative z-10 flex-1">
                                <h3 class="font-bold text-xl md:text-2xl">Insight & Challenge Harian</h3>
                                <!-- (MODIFIKASI) Mengganti ** dengan <strong> -->
                                <p class="mt-2 text-sm md:text-base opacity-95">Pola jurnalmu menunjukkan fokus tinggi pada target. Kami sarankan kamu <strong>mengambil istirahat mental</strong>. Selesaikan mini-game <strong>"Tarik Napas"</strong> sekarang!</p>
                                <button onclick="showPage('page-game-breathe')" class="mt-4 bg-white text-indigo-700 font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-100 transition-all text-sm flex-shrink-0">
                                    Mulai Tarik Napas (5 Poin)
                                </button>
                            </div>
                            <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-white/10 rounded-full opacity-50 z-0"></div>
                        </div>
                    </div>

                    <!-- Row 2: Right (1/3) - Vibe Select -->
                    <div class="lg:col-span-1 space-y-6 flex flex-col">
                        <!-- Pilihan Vibe Cepat Berwarna -->
                        <div class="bg-gray-800/50 backdrop-blur-sm p-6 rounded-2xl shadow-lg card-hover relative h-full border border-gray-700">
                            <h3 class="text-xl font-semibold text-white mb-4 relative z-10">Vibe Cepat Hari Ini</h3>
                            <div class="grid grid-cols-2 gap-3 relative z-10" id="vibe-selection">
                                <div onclick="selectVibe('Senang', this)" class="vibe-btn p-3 bg-white/10 rounded-xl cursor-pointer hover:bg-white/20 transition-all active:scale-95 ring-0 ring-white flex items-center justify-center space-x-2">
                                    <span class="text-2xl">ðŸ˜Š</span>
                                    <p class="font-medium text-white text-sm">Senang</p>
                                </div>
                                <div onclick="selectVibe('Tenang', this)" class="vibe-btn p-3 bg-white/10 rounded-xl cursor-pointer hover:bg-white/20 transition-all active:scale-95 ring-0 ring-white flex items-center justify-center space-x-2">
                                    <span class="text-2xl">ðŸ˜Œ</span>
                                    <p class="font-medium text-white text-sm">Tenang</p>
                                </div>
                                <div onclick="selectVibe('Cemas', this)" class="vibe-btn p-3 bg-white/10 rounded-xl cursor-pointer hover:bg-white/20 transition-all active:scale-95 ring-0 ring-white flex items-center justify-center space-x-2">
                                    <span class="text-2xl">ðŸ˜Ÿ</span>
                                    <p class="font-medium text-white text-sm">Cemas</p>
                                </div>
                                <div onclick="selectVibe('Marah', this)" class="vibe-btn p-3 bg-white/10 rounded-xl cursor-pointer hover:bg-white/20 transition-all active:scale-95 ring-0 ring-white flex items-center justify-center space-x-2">
                                    <span class="text-2xl">ðŸ˜ </span>
                                    <p class="font-medium text-white text-sm">Marah</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Row 3: Quote Carousel (Full Width) -->
                    <div class="lg:col-span-3">
                        <div id="quote-carousel-container" class="relative bg-gradient-to-br from-teal-500 to-cyan-600 text-white p-6 rounded-2xl shadow-lg overflow-hidden h-48 md:h-56 card-hover">
                            <div id="quote-track" class="absolute top-0 left-0 h-full flex"> 
                                <!-- Kutipan akan di-generate oleh JS -->
                            </div>
                            <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2 z-20" id="quote-dots">
                                <!-- Dots akan di-generate oleh JS -->
                            </div>
                        </div>
                    </div>

                    <!-- (MODIFIKASI) Row 4: Hasil Tes Terakhir (Bar Charts) -->
                    <div class="lg:col-span-3">
                        <div class="bg-gray-800/50 backdrop-blur-sm text-white p-6 rounded-2xl shadow-lg card-hover relative flex-1 border border-gray-700">
                            <h3 class="text-xl font-semibold text-white mb-4">Ringkasan Tes Terakhir</h3>
                            <p class="text-gray-300 mb-4 text-sm">Fokus kami berdasarkan hasil tes terakhir Anda:</p>
                            
                            <!-- (MODIFIKASI) Mengembalikan Bar Charts -->
                            <div class="space-y-6">
                                <!-- Bar Stres (ID Unik: dash-chart-stres) -->
                                <div id="dash-chart-stres-container">
                                    <span class="text-lg font-semibold text-red-400">Stres</span>
                                    <div class="flex-1 bg-black/20 rounded-full h-6 mt-2 shadow-inner">
                                        <div id="dash-chart-stres" class="chart-bar bg-gradient-to-r from-red-400 to-red-600 h-6 rounded-full flex items-center justify-end pr-3">
                                            <span class="text-sm font-bold text-white">Tinggi</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Bar Kecemasan (ID Unik: dash-chart-cemas) -->
                                <div id="dash-chart-cemas-container">
                                    <span class="text-lg font-semibold text-yellow-400">Kecemasan</span>
                                    <div class="flex-1 bg-black/20 rounded-full h-6 mt-2 shadow-inner">
                                        <div id="dash-chart-cemas" class="chart-bar bg-gradient-to-r from-yellow-400 to-yellow-600 h-6 rounded-full flex items-center justify-end pr-3">
                                            <span class="text-sm font-bold text-white">Sedang</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Bar Depresi (ID Unik: dash-chart-depresi) -->
                                <div id="dash-chart-depresi-container">
                                    <span class="text-lg font-semibold text-blue-400">Depresi</span>
                                    <div class="flex-1 bg-black/20 rounded-full h-6 mt-2 shadow-inner">
                                        <div id="dash-chart-depresi" class="chart-bar bg-gradient-to-r from-blue-400 to-blue-600 h-6 rounded-full flex items-center justify-end pr-3">
                                            <span class="text-sm font-bold text-white">Rendah</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button onclick="showPage('page-test')" class="mt-5 text-sm font-semibold text-white hover:text-indigo-400">Ambil Tes Lain &rarr;</button>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <!-- Halaman 2: Jurnal Harian (Dengan fitur Gemini) -->
            <div id="page-journal" class="page p-6 md:p-12 space-y-6 hidden">
                <!-- Header Halaman -->
                <div class="w-full">
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Jurnal Harian</h1>
                </div>
                
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Kolom Kiri: Input Jurnal -->
                    <div class="lg:w-1/2 space-y-6">
                        <!-- Pelacak Mood (Dark Mode) -->
                        <div class="bg-gray-800/50 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-gray-700">
                            <h3 class="font-semibold text-gray-300 mb-4 text-base md:text-lg text-center">Bagaimana mood-mu untuk entri ini?</h3>
                            <div class="flex justify-around" id="mood-selection">
                                <button onclick="selectMood('ðŸ˜­', this)" class="mood-btn p-2 md:p-3 rounded-full hover:bg-red-900/50 transition-all active:scale-95 ring-0 ring-red-400">
                                    <span class="text-3xl md:text-4xl">ðŸ˜­</span>
                                </button>
                                 <button onclick="selectMood('ðŸ˜Ÿ', this)" class="mood-btn p-2 md:p-3 rounded-full hover:bg-yellow-900/50 transition-all active:scale-95 ring-0 ring-yellow-400">
                                    <span class="text-3xl md:text-4xl">ðŸ˜Ÿ</span>
                                </button>
                                <button onclick="selectMood('ðŸ˜Œ', this)" class="mood-btn p-2 md:p-3 rounded-full hover:bg-blue-900/50 transition-all active:scale-95 ring-0 ring-blue-400 ring-2">
                                    <span class="text-3xl md:text-4xl">ðŸ˜Œ</span>
                                </button>
                                <button onclick="selectMood('ðŸ˜Š', this)" class="mood-btn p-2 md:p-3 rounded-full hover:bg-indigo-900/50 transition-all active:scale-95 ring-0 ring-indigo-400">
                                    <span class="text-3xl md:text-4xl">ðŸ˜Š</span>
                                </button>
                                <button onclick="selectMood('ðŸ¤©', this)" class="mood-btn p-2 md:p-3 rounded-full hover:bg-green-900/50 transition-all active:scale-95 ring-0 ring-green-400">
                                    <span class="text-3xl md:text-4xl">ðŸ¤©</span>
                                </button>
                            </div>
                        </div>
                        <!-- Kartu Pertanyaan Reflektif (Dark Mode) -->
                        <div class="bg-gray-800/50 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-gray-700">
                            <div id="journal-prompt-header" class="flex justify-between items-center mb-2">
                                <h3 class="font-semibold text-gray-400">Pertanyaan Hari Ini:</h3>
                                <div class="flex space-x-2">
                                    <button onclick="loadJournalPrompt(true)" class="text-sm font-semibold text-indigo-400 hover:text-indigo-300 transition-all flex items-center space-x-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12h-4"></path><path d="M17 5v14"></path><path d="M22 17l-5 5-5-5"></path><path d="M12 2v20"></path></svg>
                                        <span>Ganti (AI)</span>
                                    </button>
                                    <!-- (BARU) Tombol Tulis Sendiri -->
                                    <button onclick="toggleCustomPrompt(true)" class="text-sm font-semibold text-gray-400 hover:text-white transition-all flex items-center space-x-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path></svg>
                                        <span>Tulis Sendiri</span>
                                    </button>
                                </div>
                            </div>
                            <p id="journal-prompt" class="text-lg md:text-xl font-medium text-white mt-2">Apa satu hal kecil yang kamu syukuri hari ini?</p>
                            
                            <!-- (BARU) Input Pertanyaan Kustom -->
                            <div id="custom-prompt-container" class="hidden space-y-2 mt-2">
                                <label for="custom-journal-prompt" class="text-sm font-semibold text-gray-400">Tulis pertanyaanmu sendiri:</label>
                                <input type="text" id="custom-journal-prompt" class="w-full p-2 bg-gray-700 border-gray-600 text-white placeholder-gray-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400" placeholder="Misal: Apa yang aku pelajari hari ini?">
                                <button onclick="toggleCustomPrompt(false)" class="text-sm font-semibold text-gray-400 hover:text-white transition-all">
                                    Batal
                                </button>
                            </div>

                            <p id="journal-prompt-loading" class="text-sm italic text-indigo-400 mt-2 hidden">Meminta prompt reflektif dari Soul-AI...</p>
                        </div>
                        <!-- Text Area (Dark Mode) -->
                        <textarea id="journal-input" class="w-full h-40 p-5 text-base bg-gray-700/60 border-gray-600 text-white placeholder-gray-400 rounded-xl shadow-inner focus:outline-none focus:ring-2 focus:ring-indigo-400" placeholder="Tuliskan ceritamu di sini..."></textarea>
                        
                        <!-- Tombol Simpan -->
                        <button onclick="saveJournal()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-4 px-6 text-base md:text-lg rounded-xl shadow-lg hover:shadow-xl hover:opacity-90 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2 active:scale-95">
                            Simpan & Dapatkan 10 Poin ðŸ”¥
                        </button>
                    </div>
                    
                    <!-- Kolom Kanan: Histori Jurnal (Dark Mode) -->
                    <div class="lg:w-1/2 bg-gray-800/50 backdrop-blur-sm p-6 rounded-2xl shadow-lg flex flex-col border border-gray-700">
                        <h3 class="text-2xl font-bold text-white mb-4">Histori Jurnal</h3>
                        <!-- Search & Filter (Dark Mode) -->
                        <div class="flex flex-col md:flex-row gap-3 mb-4">
                            <div class="relative flex-grow">
                                <input type="search" id="journal-search" onkeyup="renderJournalHistory()" class="w-full pl-10 pr-4 py-2 bg-gray-700 border-gray-600 text-white placeholder-gray-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400" placeholder="Cari di jurnal...">
                                <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            </div>
                            <select id="journal-sort" onchange="renderJournalHistory()" class="bg-gray-700 border-gray-600 text-white rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-400">
                                <option value="terbaru">Sortir: Terbaru</option>
                                <option value="terlama">Sortir: Terlama</option>
                            </select>
                        </div>
                        <!-- Daftar Histori -->
                        <div id="journal-history-list" class="flex-1 space-y-4 overflow-y-auto pr-2" style="max-height: 500px;">
                            <!-- Histori akan di-render oleh JS di sini -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Halaman 3: Pilihan Mini-Games -->
            <div id="page-games" class="page p-6 md:p-12 space-y-8 hidden">
                <!-- Header Halaman -->
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Permainan Reflektif</h1>
                    <p class="text-base md:text-lg text-gray-300 mt-1">Latih pikiranmu dengan cara yang seru dan dapatkan poin!</p>
                </div>
                <!-- Daftar Game -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                    
                    <!-- Game 1: Tarik Napas -->
                    <div onclick="showPage('page-game-breathe')" class="bg-gradient-to-br from-blue-500 to-blue-700 text-white p-6 rounded-2xl shadow-lg cursor-pointer game-card-hover space-y-4">
                        <div class="p-4 bg-white/20 rounded-lg w-min shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16.4 18.2c.3-.2.6-.4.8-.7a4.3 4.3 0 0 0 1.2-3.4c0-1.6-1-3-2.4-3.8"></path><path d="M12 2a4.3 4.3 0 0 0-1.2 3.4c0 1.6 1 3 2.4 3.8"></path><path d="M7.6 18.2c-.3-.2-.6-.4-.8-.7a4.3 4.3 0 0 1-1.2-3.4c0-1.6 1-3 2.4-3.8"></path><path d="M12 22a4.3 4.3 0 0 1 1.2-3.4c0-1.6-1-3-2.4-3.8"></path><path d="M2 10.3a4.3 4.3 0 0 0 1.9 3.5 4.3 4.3 0 0 0 5.2.3"></path><path d="M22 10.3a4.3 4.3 0 0 1-1.9 3.5 4.3 4.3 0 0 1-5.2.3"></path><circle cx="12" cy="12" r="2"></circle></svg>
                        </div>
                        <h4 class="text-2xl font-semibold text-white">Tarik Napas</h4>
                        <p class="text-base text-blue-100">Latihan 1 menit untuk lebih tenang dan fokus.</p>
                        <span class="inline-block bg-white text-blue-800 text-sm font-medium px-3 py-1 rounded-full">+5 Poin</span>
                    </div>

                    <!-- Game 2: Filter Pikiran -->
                    <div onclick="showPage('page-game-filter')" class="bg-gradient-to-br from-green-500 to-green-700 text-white p-6 rounded-2xl shadow-lg cursor-pointer game-card-hover space-y-4">
                        <div class="p-4 bg-white/20 rounded-lg w-min shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 6 3 3 3-3"></path><path d="m3 12 3 3 3-3"></path><path d="m3 18 3 3 3-3"></path><line x1="12" y1="6" x2="21" y2="6"></line><line x1="12" y1="12" x2="21" y2="12"></line><line x1="12" y1="18" x2="21" y2="18"></line></svg>
                        </div>
                        <h4 class="text-2xl font-semibold text-white">Filter Pikiran</h4>
                        <p class="text-base text-green-100">Sortir pikiran yang bermanfaat & tidak bermanfaat.</p>
                        <span class="inline-block bg-white text-green-800 text-sm font-medium px-3 py-1 rounded-full">+5 Poin</span>
                    </div>

                    <!-- Game 3: Toples Kekhawatiran -->
                    <div onclick="showPage('page-game-worry')" class="bg-gradient-to-br from-pink-500 to-pink-700 text-white p-6 rounded-2xl shadow-lg cursor-pointer game-card-hover space-y-4">
                        <div class="p-4 bg-white/20 rounded-lg w-min shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2.81v2.32c0 .5.2.98.6 1.35l4.1 3.9c.7.67 1.2 1.5.1 2.45-1.1 1-.4 2.8 1 3.4.9.4 2.1.2 3.1-.4l4.1-3.9c.4-.37.6-.85.6-1.35V2.81"/>
<path d="M7 21h10"/>
<path d="M12 21v-2.5c0-.8-.7-1.5-1.5-1.5h-1c-.8 0-1.5.7-1.5 1.5V21"/>
<path d="M6 18c-1.1 0-2-.9-2-2V7c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v9c0 1.1-.9 2-2 2"/>
<path d="M14 5v.5c0 .3.2.5.5.5h1c.3 0 .5-.2.5-.5V5"/></svg>
                        </div>
                        <h4 class="text-2xl font-semibold text-white">Toples Kekhawatiran</h4>
                        <p class="text-base text-pink-100">Lepaskan kecemasanmu dengan menuliskannya di sini.</p>
                        <span class="inline-block bg-white text-pink-800 text-sm font-medium px-3 py-1 rounded-full">+5 Poin</span>
                    </div>

                    <!-- Game 4: Soundscape (DINONAKTIFKAN) -->
                    <div class="bg-gradient-to-br from-cyan-500 to-teal-600 text-white p-6 rounded-2xl shadow-lg transition-all opacity-60 space-y-4">
                        <div class="p-4 bg-white/20 rounded-lg w-min shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19c-5 0-9-3.5-9-8V7c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v4c0 4.5-4 8-9 8z"/><path d="M12 11v0"/><path d="M8.5 14v0"/><path d="M15.5 14v0"/></svg>
                        </div>
                        <h4 class="text-2xl font-semibold text-white">Soundscape</h4>
                        <p class="text-base text-cyan-100">Dengarkan suara alam yang menenangkan pikiranmu.</p>
                        <span class="inline-block bg-white/50 text-white text-sm font-medium px-3 py-1 rounded-full">Segera Hadir</span>
                    </div>
                </div>
            </div>
            
            <!-- Halaman 4: Mini-Game Tarik Napas -->
            <div id="page-game-breathe" class="page p-6 md:p-12 hidden">
                <!-- Header Halaman -->
                <div class="flex items-center space-x-3 mb-8">
                    <button onclick="stopBreatheGame(); showPage('page-games');" class="p-2 bg-white/10 hover:bg-white/20 rounded-full active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                    </button>
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Tarik Napas</h1>
                </div>
                <!-- Konten Game -->
                <div class="flex flex-col items-center justify-center h-[60vh] text-center bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-700">
                    <div class="relative w-48 h-48 md:w-64 md:h-64 flex items-center justify-center">
                        <div class="absolute w-full h-full bg-blue-200 rounded-full breathing-circle"></div>
                        <div class="absolute w-3/4 h-3/4 md:w-48 md:h-48 bg-blue-300 rounded-full breathing-circle" style="animation-delay: -0.5s;"></div>
                        <div class="absolute w-1/2 h-1/2 md:w-32 md:h-32 bg-blue-400 rounded-full breathing-circle" style="animation-delay: -1s;"></div>
                    </div>
                    <p id="breathe-text" class="text-2xl md:text-3xl font-semibold text-white mt-16">Siap?</p>
                </div>
            </div>

            <!-- Halaman 5: Mini-Game Filter Pikiran -->
            <div id="page-game-filter" class="page p-6 md:p-12 hidden">
                <!-- Header Halaman -->
                <div class="flex items-center space-x-3 mb-8">
                    <button onclick="showPage('page-games');" class="p-2 bg-white/10 hover:bg-white/20 rounded-full active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                    </button>
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Filter Pikiran</h1>
                </div>
                <!-- Konten Game -->
                <div class="flex flex-col items-center justify-center h-[60vh] text-center bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-lg p-6 md:p-10 border border-gray-700">
                    <p class="text-lg md:text-2xl text-gray-300">Apakah pikiran ini...</p>
                    <!-- Kartu Pikiran -->
                    <div id="thought-card" class="thought-card bg-gray-700/60 p-6 md:p-8 rounded-2xl shadow-inner w-full max-w-lg my-6 min-h-[150px] flex items-center justify-center">
                        <p id="thought-text" class="text-xl md:text-3xl font-medium text-white">Saya pasti akan gagal dalam presentasi ini.</p>
                    </div>
                    <!-- Tombol Pilihan -->
                    <div class="w-full max-w-lg flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-4">
                        <button onclick="checkThought(false)" class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold py-4 px-5 text-base md:text-lg rounded-xl shadow-lg hover:shadow-xl hover:opacity-90 transition-all active:scale-95">
                            Tidak Bermanfaat
                        </button>
                        <button onclick="checkThought(true)" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold py-4 px-5 text-base md:text-lg rounded-xl shadow-lg hover:shadow-xl hover:opacity-90 transition-all active:scale-95">
                            Bermanfaat
                        </button>
                    </div>
                    <!-- Feedback -->
                    <p id="filter-feedback" class="text-lg md:text-2xl font-semibold h-10 mt-6"></p>
                </div>
            </div>

            <!-- Halaman 6: Profil (Mock) -->
            <div id="page-profile" class="page p-6 md:p-12 space-y-8 hidden">
                <!-- Header Halaman -->
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Profil & Pencapaian</h1>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Kolom Kiri: Info & Streak -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Kartu Profil Berwarna -->
                        <div class="flex flex-col items-center space-y-3 bg-gradient-to-br from-purple-500 to-violet-700 text-white p-8 rounded-2xl shadow-lg card-hover">
                            <img src="https://placehold.co/120x120/E9D5FF/4C1D95?text=DH" onerror="this.onerror=null;this.src='https://placehold.co/120x120/E9D5FF/4C1D95?text=DH';" alt="Foto Profil" class="w-32 h-32 rounded-full border-4 border-purple-200 shadow-lg">
                            <h2 class="text-3xl font-semibold text-white">Dona Haryanto</h2>
                            <p class="text-base text-purple-100">Bergabung Sejak 2025</p>
                        </div>
                        <!-- Kartu Streak Berwarna -->
                        <div class="bg-gradient-to-br from-orange-500 to-red-600 text-white p-6 rounded-xl shadow-lg text-center card-hover">
                            <h3 class="text-xl font-semibold text-white">Streak Jurnal</h3>
                            <div class="flex items-center justify-center space-x-3 mt-3">
                                <span class="text-5xl">ðŸ”¥</span>
                                <span id="streak-count" class="text-5xl font-bold text-white">5</span>
                                <span class="text-lg text-orange-100">hari!</span>
                            </div>
                        </div>
                        <!-- Kartu Poin Berwarna + IKON PERMATA -->
                        <div class="bg-gradient-to-br from-indigo-500 to-blue-600 text-white p-6 rounded-xl shadow-lg text-center card-hover">
                            <h3 class="text-xl font-semibold text-white flex items-center justify-center space-x-2">
                                <!-- (MODIFIKASI) Ikon Koin diganti Ikon Permata (Gem) -->
                               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><path d="M6 3h12l4 6-10 13L2 9Z"></path><path d="M12 22 2 9"></path><path d="m22 9-4-6"></path></svg>
                                <span>Total Poin Refleksi</span>
                            </h3>
                            <span id="total-points" class="text-5xl font-bold text-white mt-3 block">120</span>
                        </div>
                    </div>
                    <!-- Kolom Kanan: Pencapaian (Dark Mode) -->
                    <div class="lg:col-span-2 bg-gray-800/50 backdrop-blur-sm p-8 rounded-2xl shadow-lg card-hover border border-gray-700">
                        <div class="relative z-10">
                            <h3 class="text-2xl font-semibold text-white mb-6 text-center">Lencana Pencapaian</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                                <!-- Lencana 1 -->
                                <div class="text-center p-4 bg-gray-700/60 rounded-lg transition-all hover:scale-105 shadow flex flex-col items-center">
                                    <span class="text-6xl">ðŸ§˜</span>
                                    <p class="text-md font-semibold text-gray-100 mt-2">Pikiran Tenang</p>
                                    <p class="text-xs text-gray-400 mt-1">Selesaikan 5x mini-game "Tarik Napas".</p>
                                </div>
                                <!-- Lencana 2 -->
                                <div class="text-center p-4 bg-gray-700/60 rounded-lg transition-all hover:scale-105 shadow flex flex-col items-center">
                                    <span class="text-6xl">âœï¸</span>
                                    <p class="text-md font-semibold text-gray-100 mt-2">Penulis Jurnal</p>
                                    <p class="text-xs text-gray-400 mt-1">Tulis jurnal 3 hari berturut-turut.</p>
                                </div>
                                <!-- Lencana 3 -->
                                <div class="text-center p-4 bg-gray-700/60 rounded-lg transition-all hover:scale-105 shadow flex flex-col items-center">
                                    <span class="text-6xl">ðŸ§ </span>
                                    <p class="text-md font-semibold text-gray-100 mt-2">Penyaring Pikiran</p>
                                    <p class="text-xs text-gray-400 mt-1">Mainkan 10x "Filter Pikiran".</p>
                                </div>
                                <!-- Lencana 4 (Terkunci) -->
                                <div class="text-center p-4 bg-gray-700/60 rounded-lg opacity-40 transition-all hover:scale-105 shadow flex flex-col items-center">
                                    <span class="text-6xl">ðŸ’ª</span>
                                    <p class="text-md font-semibold text-gray-100 mt-2">Mental Kuat</p>
                                    <p class="text-xs text-gray-400 mt-1">Capai 7 hari streak jurnal.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Halaman 7: Tes Awal -->
            <div id="page-test" class="page p-6 md:p-12 hidden">
                <!-- Header Halaman -->
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Pusat Tes Kesehatan Mental</h1>
                    <p class="text-base md:text-lg text-gray-300 mt-1">Pilih tes berdasarkan apa yang ingin kamu ketahui saat ini.</p>
                </div>
                <!-- Pilihan Kategori Tes -->
                <div id="test-categories" class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                    
                    <!-- Kategori 1: Tes Stres Berwarna -->
                    <div class="bg-gradient-to-br from-red-500 to-red-700 text-white p-6 md:p-8 rounded-2xl shadow-lg card-hover flex flex-col relative z-0">
                        <div class="p-4 bg-white/20 rounded-xl w-min mb-4 shadow-lg relative z-10">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="20" x2="4" y2="8"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="20" y1="20" x2="20" y2="12"></line></svg>
                        </div>
                        <h3 class="text-2xl font-semibold text-white relative z-10">Tes Stres</h3>
                        <p class="text-red-100 mt-2 flex-1 relative z-10">Merasa tertekan? Cek level stresmu (5 pertanyaan).</p>
                        <button onclick="startTest('stres')" class="mt-4 w-full bg-white text-red-700 font-bold py-3 px-6 text-lg rounded-xl shadow-lg hover:bg-gray-100 transition-all active:scale-95 relative z-10">
                            Mulai Tes
                        </button>
                    </div>
                    
                    <!-- Kategori 2: Tes Kecemasan Berwarna -->
                    <div class="bg-gradient-to-br from-yellow-500 to-amber-600 text-white p-6 md:p-8 rounded-2xl shadow-lg card-hover flex flex-col relative z-0">
                        <div class="p-4 bg-white/20 rounded-xl w-min mb-4 shadow-lg relative z-10">
                             <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                        </div>
                        <h3 class="text-2xl font-semibold text-white relative z-10">Tes Kecemasan</h3>
                        <p class="text-yellow-100 mt-2 flex-1 relative z-10">Sering cemas atau panik? Tes ini (5 pertanyaan) bisa membantu.</p>
                        <button onclick="startTest('cemas')" class="mt-4 w-full bg-white text-yellow-700 font-bold py-3 px-6 text-lg rounded-xl shadow-lg hover:bg-gray-100 transition-all active:scale-95 relative z-10">
                            Mulai Tes
                        </button>
                    </div>

                    <!-- Kategori 3: Tes Mood/Depresi Berwarna -->
                    <div class="bg-gradient-to-br from-blue-500 to-blue-700 text-white p-6 md:p-8 rounded-2xl shadow-lg card-hover flex flex-col relative z-0">
                        <div class="p-4 bg-white/20 rounded-xl w-min mb-4 shadow-lg relative z-10">
                             <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="8" y1="15" x2="16" y2="15"></line><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
                        </div>
                        <h3 class="text-2xl font-semibold text-white relative z-10">Tes Mood (Depresi)</h3>
                        <p class="text-blue-100 mt-2 flex-1 relative z-10">Merasa sedih belakangan ini? Cek mood-mu (5 pertanyaan).</p>
                        <button onclick="startTest('depresi')" class="mt-4 w-full bg-white text-blue-700 font-bold py-3 px-6 text-lg rounded-xl shadow-lg hover:bg-gray-100 transition-all active:scale-95 relative z-10">
                            Mulai Tes
                        </button>
                    </div>
                </div>
                <!-- Pertanyaan Kuis (disembunyikan) -->
                <div id="test-questions" class="mt-6 bg-gray-800/50 backdrop-blur-sm p-6 md:p-8 rounded-2xl shadow-lg max-w-2xl w-full mx-auto border border-gray-700" style="display: none;">
                    <p class="text-sm font-medium text-indigo-400 text-center" id="question-progress">Pertanyaan 1 dari 5</p>
                    <h3 class="text-xl md:text-2xl font-semibold text-white mt-2 text-center" id="question-text">Saya merasa sulit untuk tenang dan rileks.</h3>
                    <div class="space-y-3 mt-6 w-full mx-auto" id="question-options">
                        <!-- Opsi akan di-generate oleh JS -->
                    </div>
                </div>
            </div>

            <!-- Halaman 8: Hasil Tes -->
            <div id="page-result" class="page p-6 md:p-12 hidden">
                <!-- Header Halaman -->
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Hasil Tes Anda</h1>
                    <p class="text-base md:text-lg text-gray-300 mt-1">Berikut adalah ringkasan kondisimu selama seminggu terakhir.</p>
                </div>
                <div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Kolom Kiri: Grafik (Dark Mode) -->
                    <div class="lg:col-span-2 bg-gray-800/50 backdrop-blur-sm p-6 md:p-8 rounded-2xl shadow-lg border border-gray-700">
                        <h3 class="text-2xl font-semibold text-white mb-8">Grafik Visual Kondisi</h3>
                        <div class="space-y-6">
                            <!-- Bar Stres -->
                            <div id="chart-stres-container">
                                <span class="text-lg font-semibold text-red-400">Stres</span>
                                <div class="flex-1 bg-black/20 rounded-full h-6 mt-2 shadow-inner">
                                    <div id="chart-stres" class="chart-bar bg-gradient-to-r from-red-400 to-red-600 h-6 rounded-full flex items-center justify-end pr-3">
                                        <span class="text-sm font-bold text-white">Tinggi</span>
                                    </div>
                                </div>
                            </div>
                            <!-- Bar Kecemasan -->
                            <div id="chart-cemas-container">
                                <span class="text-lg font-semibold text-yellow-400">Kecemasan</span>
                                <div class="flex-1 bg-black/20 rounded-full h-6 mt-2 shadow-inner">
                                    <div id="chart-cemas" class="chart-bar bg-gradient-to-r from-yellow-400 to-yellow-600 h-6 rounded-full flex items-center justify-end pr-3">
                                        <span class="text-sm font-bold text-white">Sedang</span>
                                    </div>
                                </div>
                            </div>
                            <!-- Bar Depresi -->
                            <div id="chart-depresi-container">
                                <span class="text-lg font-semibold text-blue-400">Depresi</span>
                                <div class="flex-1 bg-black/20 rounded-full h-6 mt-2 shadow-inner">
                                    <div id="chart-depresi" class="chart-bar bg-gradient-to-r from-blue-400 to-blue-600 h-6 rounded-full flex items-center justify-end pr-3">
                                        <span class="text-sm font-bold text-white">Rendah</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Kolom Kanan: Rekomendasi AI -->
                    <div id="ai-recommendation-box" class="lg:col-span-1 bg-gradient-to-br from-indigo-500 to-purple-600 text-white p-6 md:p-8 rounded-2xl shadow-2xl">
                        <h3 class="font-bold text-2xl mb-4">Rekomendasi Soul-AI</h3>
                        <div id="ai-recommendation-content" class="space-y-4 text-base opacity-90">
                            <!-- Konten akan diperbarui oleh JS -->
                            <p>Hasil tes menunjukkan level <strong class="font-bold">Stres yang cukup tinggi</strong>. Ini wajar dirasakan saat banyak tekanan.</p>
                            <p>Kami merekomendasikanmu untuk mencoba:</p>
                            <ul class="list-disc list-inside space-y-2">
                                <li><strong>Mini-Game "Tarik Napas"</strong> 2x sehari.</li>
                                <li><strong>Jurnal Harian</strong> untuk mencatat apa yang membuatmu stres.</li>
                                <li>Bicara dengan <strong>Soul-AI Chat</strong> untuk refleksi cepat.</li>
                            </ul>
                            <p class="mt-4"><strong class="font-semibold">Ingat, ini bukan diagnosis.</strong> Jika merasa sangat terganggu, jangan ragu hubungi profesional.</p>
                        </div>
                        <button onclick="showPage('page-games')" class="mt-6 w-full bg-white text-indigo-700 font-semibold py-3 px-5 text-base rounded-xl shadow-lg hover:shadow-xl hover:opacity-90 transition-all active:scale-95">
                            Coba Mini-Game Sekarang
                        </button>
                    </div>
                </div>
            </div>

            <!-- Halaman 9: Soul-AI Chat (Dengan integrasi Gemini) -->
            <div id="page-chat" class="page p-6 md:p-12 hidden">
                <!-- Header Halaman -->
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Soul-AI Chat</h1>
                    <p class="text-base md:text-lg text-gray-300 mt-1">Teman refleksi digitalmu. Aman, anonim, dan selalu ada.</p>
                </div>
                <!-- Konten Chat (Dark Mode) -->
                <div class="mt-6 bg-gray-800/50 backdrop-blur-sm h-[65vh] rounded-2xl shadow-lg flex flex-col border border-gray-700">
                    <!-- Area Pesan -->
                    <div id="chat-messages" class="flex-1 p-4 md:p-6 space-y-4 overflow-y-auto">
                        <!-- Pesan Awal AI (Dark Mode) -->
                        <div class="chat-bubble flex justify-start">
                            <div class="bg-gray-700 text-gray-100 p-3 md:p-4 rounded-t-2xl rounded-br-2xl max-w-lg">
                                <p>Halo! Aku Soul-AI. Aku ada untuk membantumu refleksi atau jika kamu hanya ingin curhat. Apa yang sedang kamu pikirkan atau rasakan hari ini?</p>
                            </div>
                        </div>
                    </div>
                    <!-- Area Input Teks (Dark Mode) -->
                    <div class="p-4 bg-gray-900/50 border-t border-gray-700 rounded-b-2xl">
                        <form id="chat-form" class="flex items-center space-x-3">
                            <input id="chat-input" type="text" placeholder="Ketik ceritamu di sini (misal: 'review jurnal harianku' atau 'aku lagi sedih')..." class="flex-1 p-4 bg-gray-700 border-gray-600 text-white placeholder-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-400">
                            <button type="submit" class="p-4 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition-all active:scale-95">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Halaman 10: Mini-Game Puzzle Syukur (DINONAKTIFKAN) -->
            <div id="page-game-puzzle" class="page p-6 md:p-12 hidden">
                <!-- ... Konten Puzzle ... -->
                <div class="text-white">Fitur Puzzle ini sedang dinonaktifkan untuk sementara.</div>
            </div>
            
            <!-- Halaman 11: Mini-Game Toples Kekhawatiran -->
            <div id="page-game-worry" class="page p-6 md:p-12 hidden">
                <!-- Header Halaman -->
                <div class="flex items-center space-x-3 mb-8">
                    <button onclick="showPage('page-games');" class="p-2 bg-white/10 hover:bg-white/20 rounded-full active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                    </button>
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Toples Kekhawatiran</h1>
                </div>
                <!-- Konten Game -->
                <div class="flex flex-col items-center justify-center text-center bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-lg p-6 md:p-10 border border-gray-700">
                    <p class="text-lg md:text-2xl text-gray-300 mb-6">Tulis kekhawatiranmu dan masukkan ke dalam toples untuk dilepaskan.</p>
                    
                    <!-- Ilustrasi Toples -->
                    <div class="relative my-4">
                        <svg id="worry-jar-svg" xmlns="http://www.w3.org/2000/svg" width="150" height="150" viewBox="0 0 24 24" fill="none" stroke="#F472B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="opacity-30 transition-all duration-500"><path d="M8 2.81v2.32c0 .5.2.98.6 1.35l4.1 3.9c.7.67 1.2 1.5.1 2.45-1.1 1-.4 2.8 1 3.4.9.4 2.1.2 3.1-.4l4.1-3.9c.4-.37.6-.85.6-1.35V2.81"/>
<path d="M7 21h10"/>
<path d="M12 21v-2.5c0-.8-.7-1.5-1.5-1.5h-1c-.8 0-1.5.7-1.5 1.5V21"/>
<path d="M6 18c-1.1 0-2-.9-2-2V7c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v9c0 1.1-.9 2-2 2"/>
<path d="M14 5v.5c0 .3.2.5.5.5h1c.3 0 .5-.2.5-.5V5"/></svg>
                        <p class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-pink-600 font-bold text-4xl" id="worry-count">0</p>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">Kekhawatiran di dalam toples</p>
                    
                    <!-- Input -->
                    <textarea id="worry-input" class="w-full max-w-lg h-24 p-4 text-base bg-gray-700/60 border-gray-600 text-white placeholder-gray-400 rounded-xl shadow-inner focus:outline-none focus:ring-2 focus:ring-pink-400" placeholder="Tulis satu kekhawatiranmu di sini..."></textarea>
                    <button onclick="saveWorry()" class="w-full max-w-lg mt-4 bg-gradient-to-r from-pink-500 to-pink-600 text-white font-semibold py-3 px-5 text-lg rounded-xl shadow-lg hover:shadow-xl hover:opacity-90 transition-all active:scale-95">
                        Masukkan ke Toples & Lepaskan
                    </button>
                </div>
            </div>

        </main> <!-- Akhir screen-content -->

    </div> <!-- Akhir app-container -->


    <!-- (BARU) Tombol Menu Mobile (Hamburger) -->
    <!-- Tombol ini muncul di mobile dan akan mentrigger sidebar -->
     <button id="mobile-menu-btn" class="fixed top-5 right-5 z-50 rounded-md bg-white/80 p-2 text-gray-900 shadow-md backdrop-blur-md transition-all duration-300 ease-in-out hidden opacity-0 md:hidden">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>


    <!-- Halaman Welcome (Tetap di luar app-container agar bisa fullscreen) -->
    <div id="page-welcome" onclick="enterApp()" class="flex flex-col items-center justify-center w-screen cursor-pointer bg-gradient-to-br from-gray-800 to-indigo-900 p-8 text-center min-h-screen">
        <!-- Ilustrasi Digital BARU -->
        <div class="w-full max-w-sm md:max-w-md">
            <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <path fill="#4f46e5" d="M48.1,-63.3C61.4,-52.1,70.5,-36.3,75.1,-18.9C79.7,-1.5,80,17.4,70.7,30.3C61.5,43.2,42.8,49.9,26.4,56.7C10.1,63.5,-3.8,70.2,-19.1,68C-34.4,65.8,-51.1,54.7,-62.4,40.1C-73.7,25.6,-79.6,7.6,-77.3,-9.3C-75,-26.2,-64.5,-42,-50.9,-53.2C-37.3,-64.3,-20.6,-70.8,-3,-69.6C14.6,-68.4,29.3,-70.4,48.1,-63.3Z" transform="translate(100 100) scale(0.9)" />
                <text x="50%" y="50%" text-anchor="middle" dy=".3em" font-size="90" font-family="Inter, sans-serif" fill="#c7d2fe" font-weight="bold">ðŸ§˜</text>
            </svg>
        </div>
        
        <!-- Teks jadi putih -->
        <h1 class="text-3xl md:text-5xl font-bold text-white mt-8">Selamat Datang di SoulCare</h1>
        <p class="text-base md:text-xl text-gray-300 mt-4 max-w-lg">Ruang aman digitalmu untuk refleksi, tes, dan penguatan kesehatan mental.</p>
        <p class="text-lg md:text-2xl font-semibold text-indigo-300 mt-12 animate-pulse">Klik di mana saja untuk memulai</p>
    </div>


    <!-- Custom Alert/Notifikasi (pojok kanan atas) -->
    <div id="custom-alert" class="fixed top-6 right-6 max-w-sm w-full z-50 opacity-0 -translate-y-10 scale-95 pointer-events-none">
        <div class="mx-auto w-full max-w-xs bg-white rounded-xl shadow-lg border border-gray-200">
            <div class="p-4 flex items-center space-x-3">
                <div id="custom-alert-icon" class="w-10 h-10 flex-shrink-0 rounded-full bg-green-100 text-green-600 flex items-center justify-center">
                    <!-- Icon akan diisi oleh JS -->
                </div>
                <div>
                    <p id="custom-alert-message" class="text-sm font-semibold text-gray-800">Jurnal tersimpan!</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ============================================= -->
    <!-- ===== (BARU) Modal Detail Jurnal ===== -->
    <!-- ============================================= -->
    <div id="journal-detail-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 transition-opacity duration-300 ease-in-out opacity-0 hidden" style="backdrop-filter: blur(4px);">
        <!-- Backdrop -->
        <div onclick="hideJournalDetail()" class="absolute inset-0 bg-black/50"></div>
        
        <!-- Konten Modal -->
        <div class="relative w-full max-w-lg rounded-2xl bg-gray-800 shadow-xl border border-gray-700 transition-transform duration-300 ease-in-out scale-95 opacity-0">
            <!-- Header Modal -->
            <div class="flex justify-between items-center p-4 border-b border-gray-700">
                <h3 class="text-xl font-semibold text-white">Detail Jurnal</h3>
                <button onclick="hideJournalDetail()" class="text-gray-400 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <!-- Isi Modal -->
            <div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto">
                <div class="flex justify-between items-center">
                    <span id="modal-mood" class="text-4xl"></span>
                    <span id="modal-date" class="text-sm text-gray-400"></span>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-400 mb-1">Pertanyaan:</h4>
                    <p id="modal-question" class="text-white font-medium text-lg"></p>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-400 mb-1">Jawabanmu:</h4>
                    <!-- whitespace-pre-wrap agar baris baru di jawaban tetap tampil -->
                    <p id="modal-answer" class="text-gray-300 whitespace-pre-wrap"></p>
                </div>
            </div>
        </div>
    </div>


    <!-- (DIHAPUS) Navigasi Bawah Horizontal LAMA -->
    <!-- ... <nav id="bottom-nav"> ... </nav> ... telah dihapus ... -->


    <script>
        // --- KONFIGURASI API GEMINI ---
        const apiKey = "AIzaSyCysNy2-QedkfKFJBeI5an9olKi8wFto2U"; // API Key (Sengaja dikosongkan)
        const modelName = "gemini-2.5-flash-preview-09-2025";
        const apiUrlBase = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

        // --- DATA GLOBAL & KONTROL NAVIGASI ---
        const pages = document.querySelectorAll('.page');
        // (MODIFIKASI) navButtons sekarang merujuk ke sidebar
        const navButtons = document.querySelectorAll('.sidebar-btn'); 
        let currentBreatheInterval = null;
        let quoteInterval = null; 
        let currentQuoteIndex = 0;
        let userStreak = 5; 
        let userPoints = 120; 
        let currentTestQuestion = 0;
        let testAnswers = { stres: 0, cemas: 0, depresi: 0 }; // Menyimpan jawaban tes
        let currentTestQuestions = []; 
        let currentMood = 'ðŸ˜Œ'; 
        let worryCount = 0; 
        let chatHistory = []; // Untuk menyimpan riwayat chat

        // Data dummy untuk histori jurnal 
        let journalHistoryData = [
            { id: 1, date: '2025-10-31T10:30:00', mood: 'ðŸ˜Š', question: "Apa satu hal kecil yang kamu syukuri hari ini?", answer: "Aku bersyukur bisa sarapan enak pagi ini dan cuacanya cerah banget." },
            { id: 2, date: '2025-10-30T21:15:00', mood: 'ðŸ˜Ÿ', question: "Apa tantangan terbesar yang kamu hadapi hari ini?", answer: "Presentasi di depan kelas tadi bikin cemas banget, tapi untungnya semua lancar. Lega banget." },
            { id: 3, date: '2025-10-29T18:00:00', mood: 'ðŸ˜Œ', question: "Siapa orang yang membuatmu tersenyum hari ini?", answer: "Waktu lagi suntuk, tiba-tiba teman lama chat ngajak main. Jadi senyum-senyum sendiri." }
        ];

        // --- FUNGSI UTILITY ---
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // --- FUNGSI GEMINI API (DENGAN BACKOFF) ---
        async function callGeminiApi(userQuery, systemPrompt = "", enableSearch = false) {
            let attempt = 0;
            const maxRetries = 5;

            while (attempt < maxRetries) {
                try {
                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: systemPrompt ? { parts: [{ text: systemPrompt }] } : undefined,
                        tools: enableSearch ? [{ "google_search": {} }] : undefined,
                    };

                    const response = await fetch(apiUrlBase, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429 && attempt < maxRetries - 1) {
                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                        await sleep(delay);
                        attempt++;
                        continue; 
                    }

                    if (!response.ok) {
                         // Throw a structured error that can be caught
                        const errorData = await response.json();
                        throw new Error(`API Error: ${response.status} - ${errorData.error.message}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf, Soul-AI tidak dapat merespons saat ini.";
                    return text;

                } catch (error) {
                    if (attempt < maxRetries - 1) {
                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                        await sleep(delay);
                        attempt++;
                    } else {
                        throw new Error(`Gagal menghubungi Soul-AI: ${error.message}`);
                    }
                }
            }
        }

        // ==================================================
        // ===== (BARU) FUNGSI MODAL DETAIL JURNAL =====
        // ==================================================
        const modal = document.getElementById('journal-detail-modal');

        /**
         * Menampilkan detail jurnal dalam modal
         * @param {number} entryId - ID dari entri jurnal yang akan ditampilkan
         */
        function showJournalDetail(entryId) {
            const entry = journalHistoryData.find(j => j.id === entryId);
            if (!entry) return;

            // Format tanggal
            const entryDate = new Date(entry.date);
            const dateString = entryDate.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            const timeString = entryDate.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

            // Isi konten modal
            document.getElementById('modal-mood').textContent = entry.mood;
            document.getElementById('modal-date').textContent = `${dateString} - ${timeString} WIB`;
            document.getElementById('modal-question').textContent = entry.question;
            document.getElementById('modal-answer').textContent = entry.answer;

            // Tampilkan modal dengan animasi
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('opacity-100');
                const modalContent = modal.querySelector('.relative.w-full');
                if (modalContent) {
                    modalContent.classList.add('scale-100', 'opacity-100');
                    modalContent.classList.remove('scale-95', 'opacity-0');
                }
            }, 10); // delay kecil untuk memicu transisi
        }

        /**
         * Menyembunyikan modal detail jurnal
         */
        function hideJournalDetail() {
            modal.classList.remove('opacity-100');
            const modalContent = modal.querySelector('.relative.w-full');
            if (modalContent) {
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
            }
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300); // Sesuaikan dengan durasi transisi CSS
        }


        // ==================================================
        // ===== (BARU) FUNGSI SIDEBAR & LOGOUT =====
        // ==================================================
        /**
         * (BARU) Toggle minimize/expand sidebar di desktop
         */
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            if (sidebar) {
                sidebar.classList.toggle('minimized');
            }
        }

        /**
         * (BARU) Fungsi placeholder untuk logout
         */
        function logout() {
            // Ini hanya placeholder, bisa diganti dengan logika logout sebenarnya
            showCustomAlert("Anda telah keluar.", "success");
            
            // Contoh: Kembali ke halaman welcome setelah logout
            setTimeout(() => {
                const appContainer = document.getElementById('app-container');
                const mobileMenuBtn = document.getElementById('mobile-menu-btn');
                const welcomePage = document.getElementById('page-welcome');

                appContainer.classList.add('opacity-0', 'hidden');
                mobileMenuBtn.classList.add('opacity-0', 'hidden');
                
                welcomePage.classList.remove('hidden');
                setTimeout(() => welcomePage.classList.remove('opacity-0'), 10);

            }, 2000);
        }


        // --- FUNGSI MASUK APLIKASI (MODIFIKASI) ---
        function enterApp() {
            const welcomePage = document.getElementById('page-welcome');
            // (MODIFIKASI) Target baru
            const appContainer = document.getElementById('app-container');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');

            welcomePage.classList.add('opacity-0');
            
            setTimeout(() => {
                welcomePage.classList.add('hidden');
                
                // (MODIFIKASI) Fade in main app container dan tombol mobile
                appContainer.classList.remove('hidden');
                mobileMenuBtn.classList.remove('hidden');

                // Dipisah agar transisi bekerja
                setTimeout(() => {
                    appContainer.classList.remove('opacity-0');
                    mobileMenuBtn.classList.remove('opacity-0');
                    showPage('page-home');
                }, 10);
                
            }, 500); 
        }

        // (MODIFIKASI) Helper getSeverity dipindah ke global scope
        const getSeverity = (score) => {
            if (score >= 80) return "Sangat Tinggi";
            if (score >= 60) return "Tinggi";
            if (score >= 35) return "Sedang";
            return "Rendah";
        };

        // (BARU) Fungsi untuk menganimasi chart di dashboard
        function animateDashboardChart() {
            const setDashChart = (id, score) => {
                const element = document.querySelector(`#dash-chart-${id}`);
                if (element) {
                    element.style.width = '0%';
                    // Pastikan elemen span ada sebelum mencoba mengatur textContent
                    const span = element.querySelector('span');
                    if (span) {
                        span.textContent = getSeverity(score);
                    }
                    
                    setTimeout(() => {
                        element.style.width = `${score}%`;
                    }, 100);
                }
            };
            
            // Set skor statis untuk dashboard (berdasarkan data dummy)
            setDashChart('stres', 70);
            setDashChart('cemas', 40);
            setDashChart('depresi', 25);
        }


        // --- KONTROL HALAMAN (MODIFIKASI) ---
        function showPage(pageId) {
            pages.forEach(page => { page.classList.add('hidden'); });
            
            const targetPage = document.getElementById(pageId);
            if (targetPage) { targetPage.classList.remove('hidden'); }

            stopBreatheGame();
            stopQuoteCarousel();

            // (MODIFIKASI) Logika Nav Bar untuk Sidebar
            const sidebarButtons = document.querySelectorAll('.sidebar-btn'); // Selector diubah
            sidebarButtons.forEach(btn => {
                let isActive = false;
                // ID tombol sidebar sekarang adalah 'nav-NAMAHALAMAN-btn'
                const navPageId = btn.id.replace('nav-', 'page-').replace('-btn', '');

                if (navPageId === pageId) {
                    isActive = true;
                } else if ((pageId === 'page-game-breathe' || pageId === 'page-game-filter' || pageId === 'page-game-worry') && navPageId === 'page-games') {
                    isActive = true;
                } else if (pageId === 'page-result' && navPageId === 'page-test') {
                    isActive = true;
                }
                
                btn.classList.toggle('active', isActive);
            });
            
            // (BARU) Tutup sidebar mobile setelah mengklik menu
            const sidebar = document.getElementById('sidebar');
            const sidebarBackdrop = document.getElementById('sidebar-backdrop');
            if (window.innerWidth < 768 && sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                sidebarBackdrop.classList.add('hidden');
                sidebarBackdrop.classList.remove('opacity-100');
            }


            // Logika spesifik per halaman
            if (pageId === 'page-home') {
                updateDashboard();
                startQuoteCarousel(); 
                animateDashboardChart(); // (MODIFIKASI) Panggil animasi chart dashboard
            }
            if (pageId === 'page-journal') {
                loadJournalPrompt();
                renderJournalHistory();
            }
            if (pageId === 'page-game-breathe') {
                startBreatheGame();
            }
            if (pageId === 'page-game-filter') {
                loadThought(); 
            }
            if (pageId === 'page-game-worry') { 
                document.getElementById('worry-count').textContent = worryCount;
            }
            if (pageId === 'page-profile') {
                updateProfile();
            }
            if (pageId === 'page-result') {
                animateChart(); 
            }
             if (pageId === 'page-test') {
                document.getElementById('test-categories').style.display = 'grid';
                document.getElementById('test-questions').style.display = 'none';
            }

            document.getElementById('screen-content').scrollTop = 0;
        }

        // (MODIFIKASI) updateDashboard
        function updateDashboard() {
            document.getElementById('stat-points').textContent = userPoints;
            document.getElementById('stat-streak').innerHTML = `ðŸ”¥ ${userStreak}`;
            document.getElementById('stat-journal-count').textContent = journalHistoryData.length;
            
            // (MODIFIKASI) Hapus update poin di sidebar, karena elemennya sudah dihapus
            // const sidebarPoints = document.getElementById('sidebar-points');
            // if (sidebarPoints) {
            //     sidebarPoints.textContent = userPoints;
            // }
        }

        // --- LOGIKA JURNAL & HISTORI (DENGAN GEMINI) ---
        const journalPrompts = [
            "Apa satu hal kecil yang kamu syukuri hari ini?",
            "Siapa orang yang membuatmu tersenyum hari ini?",
            "Apa tantangan terbesar yang kamu hadapi hari ini dan bagaimana kamu mengatasinya?",
            "Tuliskan 3 hal yang kamu sukai dari dirimu sendiri.",
            "Bagaimana perasaanmu saat ini? Coba deskripsikan dengan jujur."
        ];

        async function loadJournalPrompt(useGemini = false) {
            document.getElementById('journal-input').value = ""; 
            const promptElement = document.getElementById('journal-prompt');
            const loadingElement = document.getElementById('journal-prompt-loading');
            
            // (BARU) Selalu reset ke tampilan prompt default
            toggleCustomPrompt(false); 

            if (useGemini) {
                loadingElement.classList.remove('hidden');
                promptElement.textContent = "Sedang memuat...";

                const systemPrompt = "Berikan satu pertanyaan reflektif singkat (1 kalimat) untuk jurnal harian. Fokus pada rasa syukur, pencapaian kecil, kejadian hari ini atau perasaan hari ini. Berikan dalam Bahasa Indonesia. Jangan ada kata damai dan sebagainya, berikan yang kritis tapi juga easy conservation dan pakai kamu karena seperti memberi pertanyaan ke pengguna. Lalu juga pertanyaannya jangan terlalu kaku tapi informal aja dan oke buat bahan reflektif ke temen";
                const userQuery = `Generate a reflective question. The user's last mood recorded was ${currentMood}.`;
                
                try {
                    const aiPrompt = await callGeminiApi(userQuery, systemPrompt);
                    promptElement.textContent = aiPrompt.trim().replace(/^"|.$/g, ''); // Hapus kutip jika ada
                    showCustomAlert("Prompt AI berhasil dimuat!", "success");
                } catch (error) {
                    promptElement.textContent = journalPrompts[Math.floor(Math.random() * journalPrompts.length)]; // Fallback
                    showCustomAlert("Gagal memuat AI Prompt. Menggunakan prompt default.", "error");
                } finally {
                    loadingElement.classList.add('hidden');
                }

            } else {
                const randomIndex = Math.floor(Math.random() * journalPrompts.length);
                promptElement.textContent = journalPrompts[randomIndex];
            }

            currentMood = 'ðŸ˜Œ'; 
            // Reset mood selection
            document.querySelectorAll('#mood-selection .mood-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-red-400', 'ring-yellow-400', 'ring-blue-400', 'ring-indigo-400', 'ring-green-400');
                if(btn.innerText.includes('ðŸ˜Œ')) { 
                    btn.classList.add('ring-2', 'ring-blue-400');
                }
            });
        }

        function saveJournal() {
            const answer = document.getElementById('journal-input').value;
            
            // (MODIFIKASI) Cek pertanyaan mana yang aktif
            const customPromptContainer = document.getElementById('custom-prompt-container');
            let question = "";

            if (!customPromptContainer.classList.contains('hidden')) {
                // Gunakan prompt kustom
                question = document.getElementById('custom-journal-prompt').value;
                if (question.trim() === "") {
                    showCustomAlert("Pertanyaan kustom tidak boleh kosong!", "error");
                    return;
                }
            } else {
                // Gunakan prompt default/AI
                question = document.getElementById('journal-prompt').textContent;
            }
            
            if(answer.trim() === "") {
                showCustomAlert("Jurnal tidak boleh kosong!", "error");
                return;
            }

            const newEntry = {
                id: Date.now(),
                date: new Date().toISOString(),
                mood: currentMood,
                question: question,
                answer: answer
            };
            
            journalHistoryData.unshift(newEntry);

            userStreak++; 
            userPoints += 10; 
            showCustomAlert("Jurnal tersimpan! +10 Poin ðŸ”¥", "success");
            
            loadJournalPrompt();
            renderJournalHistory();
            
            setTimeout(() => { showPage('page-home'); }, 1500);
        }

        function selectMood(mood, element) {
            currentMood = mood; 
            const buttons = document.querySelectorAll('#mood-selection .mood-btn');
            buttons.forEach(btn => {
                btn.classList.remove('ring-2', 'ring-red-400', 'ring-yellow-400', 'ring-blue-400', 'ring-indigo-400', 'ring-green-400');
            });
            
            element.classList.add('ring-2');
            if (mood.includes('ðŸ˜­')) element.classList.add('ring-red-400');
            else if (mood.includes('ðŸ˜Ÿ')) element.classList.add('ring-yellow-400');
            else if (mood.includes('ðŸ˜Œ')) element.classList.add('ring-blue-400');
            else if (mood.includes('ðŸ˜Š')) element.classList.add('ring-indigo-400');
            else if (mood.includes('ðŸ¤©')) element.classList.add('ring-green-400');
        }
        
        // (MODIFIKASI) renderJournalHistory
        function renderJournalHistory() {
            const listContainer = document.getElementById('journal-history-list');
            const searchTerm = document.getElementById('journal-search').value.toLowerCase();
            const sortOrder = document.getElementById('journal-sort').value;
            
            listContainer.innerHTML = ''; 

            let filteredData = journalHistoryData.filter(entry => 
                entry.question.toLowerCase().includes(searchTerm) ||
                entry.answer.toLowerCase().includes(searchTerm)
            );

            filteredData.sort((a, b) => {
                if (sortOrder === 'terbaru') {
                    return new Date(b.date) - new Date(a.date);
                } else {
                    return new Date(a.date) - new Date(b.date);
                }
            });

            if (filteredData.length === 0) {
                 listContainer.innerHTML = `<p class="text-gray-500 text-center mt-4">Tidak ada jurnal ditemukan.</p>`;
                 return;
            }
            
            filteredData.forEach(entry => {
                const entryDate = new Date(entry.date);
                const dateString = entryDate.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
                const timeString = entryDate.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

                // (MODIFIKASI) Tambahkan onclick="showJournalDetail(...)" dan line-clamp-1
                const entryHtml = `
                    <div onclick="showJournalDetail(${entry.id})" class="bg-gray-700/60 p-4 rounded-lg border border-gray-600 transition-all hover:bg-gray-700 cursor-pointer active:scale-95">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-2xl">${entry.mood}</span>
                            <span class="text-sm font-medium text-gray-400">${dateString} - ${timeString}</span>
                        </div>
                        <p class="font-semibold text-gray-100 text-sm mb-1 line-clamp-1">${entry.question}</p>
                        <p class="text-gray-300 text-sm line-clamp-2">${entry.answer}</p>
                    </div>
                `;
                listContainer.innerHTML += entryHtml;
            });
        }
        
        // --- LOGIKA "VIBE CEPAT" ---
        function selectVibe(vibe, element) {
            const header = document.getElementById('vibe-header');
            header.textContent = `Oke, kamu merasa ${vibe} hari ini. Tercatat!`;
            
            const buttons = document.querySelectorAll('#vibe-selection .vibe-btn');
            buttons.forEach(btn => {
                btn.classList.remove('ring-2', 'ring-white');
            });

            element.classList.add('ring-2', 'ring-white');
        }

        // --- LOGIKA GAME PERNAPASAN ---
        const breatheText = document.getElementById('breathe-text');
        const breatheSteps = ["Tarik Napas...", "Tahan...", "Hembuskan..."];
        let currentBreatheStep = 0;

        function startBreatheGame() {
            if (currentBreatheInterval) return; 
            function nextStep() {
                if(breatheText) breatheText.textContent = breatheSteps[currentBreatheStep];
                currentBreatheStep = (currentBreatheStep + 1) % breatheSteps.length;
            }
            nextStep();
            currentBreatheInterval = setInterval(nextStep, 3500); 
            // Beri reward setelah satu siklus penuh
            setTimeout(() => {
                userPoints += 5;
                showCustomAlert("Latihan napas selesai! +5 Poin ðŸ§˜", "success");
            }, 3500 * 3.5);
        }

        function stopBreatheGame() {
            clearInterval(currentBreatheInterval);
            currentBreatheInterval = null;
            if(breatheText) breatheText.textContent = "Siap?";
            currentBreatheStep = 0;
        }

        // --- LOGIKA GAME FILTER PIKIRAN ---
        const thoughts = [
            { text: "Saya pasti akan gagal dalam presentasi ini.", isHelpful: false },
            { text: "Saya sudah berlatih, saya akan lakukan yang terbaik.", isHelpful: true },
            { text: "Semua orang menertawakan saya.", isHelpful: false },
            { text: "Saya bisa belajar dari kesalahan jika itu terjadi.", isHelpful: true },
            { text: "Ini terlalu sulit, saya menyerah.", isHelpful: false }
        ];
        let currentThoughtIndex = 0;
        
        function loadThought() {
            const thoughtCard = document.querySelector('#page-game-filter #thought-card');
            const thoughtText = document.querySelector('#page-game-filter #thought-text');
            const filterFeedback = document.querySelector('#page-game-filter #filter-feedback');

            if (currentThoughtIndex >= thoughts.length) {
                currentThoughtIndex = 0; 
            }
            if (!thoughtCard) return; 
            
            thoughtCard.style.opacity = '0';
            thoughtCard.style.transform = 'scale(0.9)';
            setTimeout(() => {
                thoughtText.textContent = thoughts[currentThoughtIndex].text;
                filterFeedback.textContent = ""; 
                filterFeedback.classList.remove('text-green-400', 'text-red-400');
                thoughtCard.style.opacity = '1';
                thoughtCard.style.transform = 'scale(1)';
            }, 300);
        }

        function checkThought(userChoice) {
            const filterFeedback = document.querySelector('#page-game-filter #filter-feedback');
            const correctChoice = thoughts[currentThoughtIndex].isHelpful;
            if (userChoice === correctChoice) {
                filterFeedback.textContent = "Tepat Sekali! +5 Poin";
                filterFeedback.classList.remove('text-red-400');
                filterFeedback.classList.add('text-green-400');
                userPoints += 5; 
            } else {
                filterFeedback.textContent = "Coba lagi!";
                filterFeedback.classList.remove('text-green-400'); 
                filterFeedback.classList.add('text-red-400');
            }
            currentThoughtIndex++; 
            setTimeout(loadThought, 1500);
        }
        
        // --- LOGIKA GAME WORRY JAR (ANIMATED) ---
        function saveWorry() {
            const input = document.getElementById('worry-input');
            const countSpan = document.getElementById('worry-count');
            const jarIcon = document.getElementById('worry-jar-svg');
            
            if (input.value.trim() === "") {
                showCustomAlert("Tulis kekhawatiranmu dulu", "error");
                return;
            }
            
            worryCount++;
            userPoints += 5;
            countSpan.textContent = worryCount;
            input.value = "";
            
            showCustomAlert("Kekhawatiran dilepaskan! +5 Poin ðŸº", "success");
            jarIcon.classList.add('shake-anim');
            setTimeout(() => {
                jarIcon.classList.remove('shake-anim');
            }, 500);
        }

        // --- LOGIKA PROFIL ---
        function updateProfile() {
            document.querySelector('#page-profile #streak-count').textContent = userStreak;
            document.querySelector('#page-profile #total-points').textContent = userPoints;
        }
        
        // --- LOGIKA TES AWAL ---
        const allTestQuestions = {
            stres: [
                { q: "Saya merasa sulit untuk tenang dan rileks.", category: 'stres' },
                { q: "Saya mudah marah atau tersinggung.", category: 'stres' },
                { q: "Saya merasa terlalu terbebani oleh pekerjaan atau tugas.", category: 'stres' },
                { q: "Saya merasa tegang atau gelisah.", category: 'stres' },
                { q: "Saya sulit berkonsentrasi karena terlalu banyak pikiran.", category: 'stres' }
            ],
            cemas: [
                { q: "Saya merasa cemas berlebihan tentang banyak hal.", category: 'cemas' },
                { q: "Saya merasa panik atau takut secara tiba-tiba.", category: 'cemas' },
                { q: "Saya tidak bisa berhenti khawatir.", category: 'cemas' },
                { q: "Saya merasa gelisah dan tidak bisa diam.", category: 'cemas' },
                { q: "Saya takut hal buruk akan terjadi.", category: 'cemas' }
            ],
            depresi: [
                { q: "Saya merasa sedih dan murung hampir sepanjang waktu.", category: 'depresi' },
                { q: "Saya kehilangan minat pada hal-hal yang biasanya saya nikmati.", category: 'depresi' },
                { q: "Saya merasa lelah tanpa alasan yang jelas.", category: 'depresi' },
                { q: "Saya merasa tidak berharga atau bersalah.", category: 'depresi' },
                { q: "Saya kesulitan tidur atau tidur terlalu banyak.", category: 'depresi' }
            ]
        };
        const testOptions = ["Tidak Pernah (0)", "Jarang (1)", "Sering (2)", "Hampir Selalu (3)"];

        function startTest(testType) {
            currentTestQuestions = allTestQuestions[testType]; 
            currentTestQuestion = 0;
            // Reset ALL scores to ensure clean slate for result page
            testAnswers = { stres: 0, cemas: 0, depresi: 0 }; 
            document.getElementById('test-categories').style.display = 'none'; 
            document.getElementById('test-questions').style.display = 'block'; 
            
            loadTestQuestion();
        }

        function loadTestQuestion() {
            const question = currentTestQuestions[currentTestQuestion];
            document.querySelector('#page-test #question-progress').textContent = `Pertanyaan ${currentTestQuestion + 1} dari ${currentTestQuestions.length}`;
            document.querySelector('#page-test #question-text').textContent = question.q;

            const optionsContainer = document.querySelector('#page-test #question-options');
            optionsContainer.innerHTML = '';
            testOptions.forEach((option, index) => {
                optionsContainer.innerHTML += `
                    <button onclick="answerQuestion(${index}, '${question.category}')" class="w-full text-left p-4 border border-gray-600 rounded-lg hover:bg-indigo-700/50 transition-all active:scale-95 text-white">
                        ${option}
                    </button>
                `;
            });
        }

        function answerQuestion(score, category) {
            testAnswers[category] += score; 
            currentTestQuestion++;
            if (currentTestQuestion < currentTestQuestions.length) {
                loadTestQuestion();
            } else {
                finishTest();
            }
        }

        function finishTest() {
            userPoints += 20; 
            showCustomAlert("Tes Selesai! +20 Poin ðŸ§ ", "success");
            
            document.getElementById('test-questions').style.display = 'none';
            document.getElementById('test-categories').style.display = 'grid';
            
            setTimeout(() => { showPage('page-result'); }, 1500);
        }

        // --- LOGIKA HASIL TES ---
        function animateChart() {
            const maxScore = (qCount) => qCount * 3; // Max score per test is 5 questions * 3 points max
            
            const maxStres = maxScore(allTestQuestions.stres.length);
            const maxCemas = maxScore(allTestQuestions.cemas.length);
            const maxDepresi = maxScore(allTestQuestions.depresi.length);
            
            let stresScore = (testAnswers.stres / maxStres) * 100 || 70;
            let cemasScore = (testAnswers.cemas / maxCemas) * 100 || 40;
            let depresiScore = (testAnswers.depresi / maxDepresi) * 100 || 25;

            // Set width and label
            const setChart = (id, score) => {
                const element = document.querySelector(`#chart-${id}`);
                const container = document.querySelector(`#chart-${id}-container`);
                if (element && container) {
                     element.style.width = `0%`;
                     element.querySelector('span').textContent = getSeverity(score);
                     
                     setTimeout(() => {
                         element.style.width = `${score}%`;
                     }, 100);
                     // Only show bars with real data or if it's the default dummy (stresScore is not 0)
                     container.style.display = (testAnswers[id] > 0 || stresScore > 0) ? 'block' : 'none';
                }
            };
            
            setChart('stres', stresScore);
            setChart('cemas', cemasScore);
            setChart('depresi', depresiScore);
            
            // Update AI Recommendation box
            const severityStres = getSeverity(stresScore);
            const recommendationBox = document.getElementById('ai-recommendation-content');
            recommendationBox.innerHTML = `
                <p>Hasil tes menunjukkan level <strong class="font-bold">${severityStres}</strong> untuk Stres. Kami merekomendasikanmu untuk mencoba:</p>
                <ul class="list-disc list-inside space-y-2">
                    <li><strong>Mini-Game "Tarik Napas"</strong> 2x sehari.</li>
                    <li><strong>Jurnal Harian</strong> untuk mencatat apa yang membuatmu stres.</li>
                    <li>Bicara dengan <strong>Soul-AI Chat</strong> untuk refleksi cepat.</li>
                </ul>
                <p class="mt-4"><strong class="font-semibold">Ingat, ini bukan diagnosis.</strong> Jika merasa sangat terganggu, jangan ragu hubungi profesional.</p>
            `;
        }
        
        // --- LOGIKA AI CHAT (DENGAN GEMINI) ---
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatMessages = document.getElementById('chat-messages');

        const systemPromptChat = "You are Soul-AI, a compassionate and non-judgmental mental health reflection partner; use a kind and empathetic Indonesian tone, always listen, ask gentle follow-up questions for deeper reflection, and suggest simple supportive activities (like journaling prompts or mini-games); if the user asks for a review of their journal, summarize their last 3 entries (if available) and ask a relevant reflective question; you MUST always respond in Indonesian, without diagnosing, and make sure your response connects naturally to the userâ€™s previous question or story.";

        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const messageText = chatInput.value.trim();
            if (messageText === "") return;

            // 1. Tampilkan pesan user
            const userBubble = document.createElement('div');
            userBubble.className = "chat-bubble flex justify-end";
            userBubble.innerHTML = `
                <div class="bg-indigo-600 text-white p-3 md:p-4 rounded-t-2xl rounded-bl-2xl max-w-lg">
                    <p>${messageText}</p>
                </div>
            `;
            chatMessages.appendChild(userBubble);
            chatHistory.push({ role: "user", parts: [{ text: messageText }] });
            
            chatInput.value = ""; 
            chatMessages.scrollTop = chatMessages.scrollHeight; 

            // 2. Tampilkan "typing..."
            const typingBubble = document.createElement('div');
            typingBubble.className = "chat-bubble flex justify-start";
            typingBubble.id = "typing-indicator";
            typingBubble.innerHTML = `
                <div class="bg-gray-700 text-gray-100 p-3 md:p-4 rounded-t-2xl rounded-br-2xl max-w-lg">
                    <p class="italic text-gray-300">Soul-AI sedang mengetik...</p>
                </div>
            `;
            chatMessages.appendChild(typingBubble);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Buat prompt untuk AI
            let aiQuery = messageText;
            if (messageText.toLowerCase().includes('review jurnal')) {
                const recentJournals = journalHistoryData.slice(0, 3).map(j => `(${j.mood} - ${j.date.substring(5, 10)}): ${j.answer}`).join(' | ');
                aiQuery = `Tolong tinjau entri jurnal terbaru saya (Last 3 entries: ${recentJournals}). Berikan ringkasan reflektif dan tanyakan satu pertanyaan tindak lanjut yang dalam.`;
            }

            try {
                const aiResponse = await callGeminiApi(aiQuery, systemPromptChat);
                const formattedResponse = formatAiResponse(aiResponse); // (MODIFIKASI)
                
                // 3. Tampilkan jawaban AI
                const aiBubble = document.createElement('div');
                aiBubble.className = "chat-bubble flex justify-start";
                 // (MODIFIKASI) Menggunakan div dengan space-y-2 dan response yang diformat
                aiBubble.innerHTML = `
                    <div class="bg-gray-700 text-gray-100 p-3 md:p-4 rounded-t-2xl rounded-br-2xl max-w-lg text-white space-y-2">
                        ${formattedResponse}
                    </div>
                `;
                chatMessages.replaceChild(aiBubble, typingBubble);
                chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
                chatMessages.scrollTop = chatMessages.scrollHeight;

            } catch (error) {
                const errorText = `[ERROR]: Maaf, Soul-AI sedang tidak terhubung. Silakan coba lagi. ${error.message}`;
                const errorBubble = document.createElement('div');
                errorBubble.className = "chat-bubble flex justify-start";
                errorBubble.innerHTML = `
                    <div class="bg-red-900 text-red-100 p-3 md:p-4 rounded-t-2xl rounded-br-2xl max-w-lg">
                        <p>${errorText}</p>
                    </div>
                `;
                chatMessages.replaceChild(errorBubble, typingBubble);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        });


        // --- (BARU) FUNGSI PARSER MARKDOWN SEDERHANA ---
        function formatAiResponse(text) {
            let html = text;
            
            // 1. Headings (must be at start of line)
            html = html.replace(/^### (.*)$/gm, '<h3 class="font-semibold text-lg mb-2 mt-4">$1</h3>');
            
            // 2. Bold and Italic
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');

            // 3. Lists (wrap in <ol> and <li>)
            // This regex finds blocks of numbered lines
            html = html.replace(/^((\d+)\. (.*\n?))+/gm, (match) => {
                const items = match.trim().split('\n');
                const listItems = items.map(item => `<li>${item.replace(/^\d+\.\s/, '')}</li>`).join('');
                return `<ol class="list-decimal list-inside space-y-1 my-2">${listItems}</ol>`;
            });

            // 4. Paragraphs (replace remaining newlines with <br>)
            html = html.replace(/\n/g, '<br>');
            
            // 5. Clean up <br> tags next to block elements
            html = html.replace(/<br>(<\/?(ol|li|h3))/g, '$1');
            html = html.replace(/(<\/(ol|li|h3))><br>/g, '$1');

            return html;
        }

        // --- (BARU) FUNGSI UNTUK TOGGLE PROMPT JURNAL ---
        function toggleCustomPrompt(show) {
            const defaultPrompt = document.getElementById('journal-prompt');
            const defaultButtons = document.getElementById('journal-prompt-header');
            const customContainer = document.getElementById('custom-prompt-container');
            const customInput = document.getElementById('custom-journal-prompt');

            if (show) {
                // Tampilkan input kustom
                defaultPrompt.classList.add('hidden');
                defaultButtons.classList.add('hidden');
                customContainer.classList.remove('hidden');
                customInput.value = '';
                customInput.focus();
            } else {
                // Tampilkan prompt default
                defaultPrompt.classList.remove('hidden');
                defaultButtons.classList.remove('hidden');
                customContainer.classList.add('hidden');
            }
        }

        // --- LOGIKA CUSTOM ALERT ---
        function showCustomAlert(message, type = 'success') {
            const alertBox = document.getElementById('custom-alert');
            const alertMessage = document.getElementById('custom-alert-message');
            const alertIcon = document.getElementById('custom-alert-icon');

            alertMessage.textContent = message;

            if (type === 'success') {
                alertIcon.innerHTML = '<span>ðŸŽ‰</span>'; 
                alertIcon.className = 'w-10 h-10 flex-shrink-0 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xl';
            } else {
                alertIcon.innerHTML = '<span>!</span>';
                alertIcon.className = 'w-10 h-10 flex-shrink-0 rounded-full bg-red-100 text-red-600 flex items-center justify-center text-xl';
            }

            alertBox.classList.remove('opacity-0', '-translate-y-10', 'scale-95', 'pointer-events-none');
            alertBox.classList.add('opacity-100', 'translate-y-0', 'scale-100');

            setTimeout(() => {
                alertBox.classList.add('opacity-0', '-translate-Y-10', 'scale-95', 'pointer-events-none');
                alertBox.classList.remove('opacity-100', 'translate-y-0', 'scale-100');
            }, 3000);
        }

        // --- LOGIKA QUOTE CAROUSEL (FIXED) ---
        const quotes = [
            { text: "Kesehatan mental... bukanlah tujuan, tapi sebuah proses. Ini tentang bagaimana kamu berkendara, bukan ke mana kamu pergi.", author: "Noam Shpancer" },
            { text: "Kamu tidak harus mengendalikan pikiranmu. Kamu hanya harus berhenti membiarkan mereka mengendalikanmu.", author: "Dan Millman" },
            { text: "Perawatan diri adalah bagaimana kamu mengambil kembali kekuatanmu.", author: "Lalah Delia" },
            { text: "Tidak apa-apa untuk tidak baik-baik saja.", author: "Anonim" }
        ];

        function stopQuoteCarousel() {
            clearInterval(quoteInterval);
            quoteInterval = null;
        }

        function startQuoteCarousel() {
            if (quoteInterval) return; 

            const track = document.getElementById('quote-track');
            const dotsContainer = document.getElementById('quote-dots');
            if (!track || !dotsContainer) return; 
            
            track.innerHTML = '';
            dotsContainer.innerHTML = '';
            
            track.style.width = `${quotes.length * 100}%`; 

            // Buat slides dan dots
            quotes.forEach((quote, index) => {
                const slide = document.createElement('div');
                // (MODIFIKASI) Menghapus 'absolute', 'top-0', 'left-0' dari slide
                slide.className = "quote-slide p-6 flex flex-col justify-center items-center text-center h-full";
                slide.style.width = `${100 / quotes.length}%`; 
                // (MODIFIKASI) Menghapus 'slide.style.transform'

                slide.innerHTML = `
                    <p class="text-lg md:text-xl font-medium text-white line-clamp-3">"${quote.text}"</p>
                    <p class="text-sm font-semibold text-teal-100 mt-3">- ${quote.author}</p>
                `;
                track.appendChild(slide);

                const dot = document.createElement('button');
                dot.className = "h-2 w-2 rounded-full bg-white/50 transition-all"; 
                dot.onclick = () => {
                    currentQuoteIndex = index;
                    updateCarousel();
                };
                dotsContainer.appendChild(dot);
            });

            function updateCarousel() {
                // (MODIFIKASI) Menggeser track menggunakan %
                const offsetPercentage = currentQuoteIndex * (100 / quotes.length);
                track.style.transform = `translateX(-${offsetPercentage}%)`;

                const allDots = dotsContainer.querySelectorAll('button');
                allDots.forEach((dot, index) => {
                    if (index === currentQuoteIndex) {
                        dot.classList.remove('bg-white/50');
                        dot.classList.add('bg-white'); 
                    } else {
                        dot.classList.add('bg-white/50');
                        dot.classList.remove('bg-white');
                    }
                });
            }

            // Mulai interval
            quoteInterval = setInterval(() => {
                currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
                updateCarousel();
            }, 5000); 

            updateCarousel(); 
        }

        // (MODIFIKASI) Pindahkan listener DOMContentLoaded ke paling bawah
        document.addEventListener('DOMContentLoaded', () => {
            // Setup Lucide icons where needed
            lucide.createIcons();

            // ================================================
            // ===== (BARU) EVENT LISTENER SIDEBAR MOBILE =====
            // ================================================
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.getElementById('sidebar');
            const sidebarBackdrop = document.getElementById('sidebar-backdrop');

            if (mobileMenuBtn && sidebar && sidebarBackdrop) {
                // Buka sidebar
                mobileMenuBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Hentikan event agar tidak tertangkap oleh backdrop
                    sidebar.classList.add('open');
                    sidebarBackdrop.classList.remove('hidden');
                    setTimeout(() => sidebarBackdrop.classList.add('opacity-100'), 10);
                });

                // Tutup sidebar saat klik backdrop
                sidebarBackdrop.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                    sidebarBackdrop.classList.remove('opacity-100');
                    setTimeout(() => sidebarBackdrop.classList.add('hidden'), 300);
                });
            }
        });
    </script>

</body>
</html>
